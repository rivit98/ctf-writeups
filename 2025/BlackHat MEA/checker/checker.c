/* This file was generated by the Hex-Rays decompiler version 9.0.0.240807.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __fastcall main(int argc, const char **argv, const char **envp);
__int64 sub_100003D88();
int *__fastcall sub_100003E30(int *result, int *a2, __int64 a3, __int64 a4);
// void __cdecl bzero(void *, size_t);
// char *__cdecl fgets(char *, int, FILE *);
// pid_t getpid(void);
// int __cdecl puts(const char *);
// size_t __cdecl strlen(const char *__s);
// int __cdecl sysctl(int *, u_int, void *, size_t *, void *, size_t);

//-------------------------------------------------------------------------
// Data declarations

const mach_header_64 _mh_execute_header = { 4277009103u, 16777228, 0, 2u, 17u, 1136u, 2097285u, 0u };
__int128 xmmword_100003F10 = 0x20000000080000001000000004LL; // weak
__int128 xmmword_100003F20 = 0xEDB883203B6E20C876DC41901DB71064LL; // weak
__int128 xmmword_100003F30 = 0x17DB9019A5C7A28D837CDBAF0B2B77D0LL; // weak
__int128 xmmword_100003F40 = 0xACEEBE818A0B17524A8920A023B4363BLL; // weak
__int128 xmmword_100003F50 = 0x64459B0AC86AADF21CD777CD5DED16C4LL; // weak
_UNKNOWN unk_100003F68; // weak
// extern FILE *__stdinp;


//----- (0000000100003980) ----------------------------------------------------
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char *v3; // x19
  size_t v4; // x0
  unsigned __int64 v5; // x20
  __int64 v6; // x8
  unsigned int v7; // w13
  unsigned int v8; // w13
  int v9; // w15
  int8x16_t v10; // q2
  const char *v11; // x0
  size_t v13; // x0
  __int64 v14; // x21
  int v15; // w24
  unsigned __int64 v16; // x23
  int v17; // w11
  int v18; // w9
  int v19; // w10
  int v20; // w8
  int v21; // w9
  int v22; // w10
  int v23; // w11
  int v24; // w8
  int v25; // w9
  int v26; // w10
  __int64 v27; // [xsp+8h] [xbp-10A8h] BYREF
  char __s[4096]; // [xsp+10h] [xbp-10A0h] BYREF
  _OWORD v29[2]; // [xsp+1010h] [xbp-A0h] BYREF
  int v30; // [xsp+1030h] [xbp-80h]
  __int128 v31; // [xsp+1040h] [xbp-70h] BYREF

  if ( argc < 2 )
  {
    if ( !fgets(__s, 4096, __stdinp) )
      return 1;
    v3 = __s;
    v13 = strlen(__s);
    if ( v13 && __s[v13 - 1] == 10 )
    {
      v3 = __s;
      __s[v13 - 1] = 0;
    }
  }
  else
  {
    v3 = (char *)argv[1];
  }
  v4 = strlen(v3);
  if ( v4 < 0xA )
    goto LABEL_18;
  if ( *v3 != 66 )
    goto LABEL_18;
  if ( v3[1] != 72 )
    goto LABEL_18;
  if ( v3[2] != 70 )
    goto LABEL_18;
  if ( v3[3] != 108 )
    goto LABEL_18;
  if ( v3[4] != 97 )
    goto LABEL_18;
  if ( v3[5] != 103 )
    goto LABEL_18;
  if ( v3[6] != 89 )
    goto LABEL_18;
  if ( v3[7] != 123 )
    goto LABEL_18;
  v5 = v4;
  if ( (_DWORD)v4 != 36 )
    goto LABEL_18;
  if ( v3[v4 - 1] != 0x7D )
    goto LABEL_18;
  v6 = 0LL;
  v7 = -1;
  do
  {
    v8 = v7 ^ (unsigned __int8)v3[v6];
    v9 = ((int)(v8 << 30) >> 31) & 0xEDB8832 ^ (v8 >> 6);
    v10 = vbicq_s8(
            (int8x16_t)xmmword_100003F20,
            (int8x16_t)vceqzq_s32((int32x4_t)vandq_s8((int8x16_t)vdupq_n_s32(v8), (int8x16_t)xmmword_100003F10)));
    *(int8x8_t *)v10.i8 = veor_s8(*(int8x8_t *)v10.i8, (int8x8_t)*(_OWORD *)&vextq_s8(v10, v10, 8uLL));
    v7 = ((v9 ^ ((int)(v8 << 31) >> 31) & 0x76DC419) << 31 >> 31) & 0x76DC4190 ^ ((v10.i32[0] ^ v9 ^ ((int)(v8 << 31) >> 31) & 0x76DC419u ^ v10.i32[1]) >> 2) ^ (v9 << 30 >> 31) & 0xEDB88320;
    ++v6;
  }
  while ( v4 != v6 );
  if ( v7 != -645377589 || (unsigned int)sub_100003D88((__n128)xmmword_100003F10, (__n128)xmmword_100003F20) )
    goto LABEL_18;
  v31 = xmmword_100003F30;
  v29[0] = xmmword_100003F40;
  v29[1] = xmmword_100003F50;
  v30 = -715467436;
  if ( v5 == 0 || v5 >= 0xFFFFFFFFFFFFFFF9LL )
    goto LABEL_58;
  v14 = 0LL;
  v15 = 0;
  v16 = (unsigned int)&_mh_execute_header.magic + 3;
  do
  {
    if ( v16 - 3 >= v5 )
      v20 = 0;
    else
      v20 = (unsigned __int8)v3[v16 - 3];
    if ( v16 - 2 >= v5 )
      v21 = 0;
    else
      v21 = (unsigned __int8)v3[v16 - 2];
    if ( v16 - 1 >= v5 )
      v22 = 0;
    else
      v22 = (unsigned __int8)v3[v16 - 1];
    if ( v16 >= v5 )
      v23 = 0;
    else
      v23 = (unsigned __int8)v3[v16];
    HIDWORD(v27) = v20 | (v21 << 8) | (v22 << 16) | (v23 << 24);
    if ( v16 + 1 >= v5 )
      v24 = 0;
    else
      v24 = (unsigned __int8)v3[v16 + 1];
    if ( v16 + 2 >= v5 )
      v25 = 0;
    else
      v25 = (unsigned __int8)v3[v16 + 2];
    if ( v16 + 3 >= v5 )
      v26 = 0;
    else
      v26 = (unsigned __int8)v3[v16 + 3];
    if ( v16 + 4 < v5 )
      v17 = (unsigned __int8)v3[v16 + 4];
    else
      v17 = 0;
    LODWORD(v27) = v24 | (v25 << 8) | (v26 << 16) | (v17 << 24);
    sub_100003E30((char *)&v27 + 4, &v27, &v31, v29);
    v18 = v27 ^ *(_DWORD *)((char *)&unk_100003F68 + v16 - 3) | HIDWORD(v27) ^ *(_DWORD *)((char *)&unk_100003F68
                                                                                         + v16
                                                                                         + 1) | v15;
    v19 = __ROR4__(v18 ^ (HIDWORD(v27) - 1515870811), -((v14 + 3) & 7)) + v18;
    if ( v27 == *(_QWORD *)((char *)&unk_100003F68 + v16 - 3) )
      v15 |= v27 ^ *(_DWORD *)((char *)&unk_100003F68 + v16 - 3) | HIDWORD(v27) ^ *(_DWORD *)((char *)&unk_100003F68
                                                                                            + v16
                                                                                            + 1);
    else
      v15 = v19;
    ++v14;
    v16 += 8LL;
  }
  while ( (v5 + 7) >> 3 != v14 );
  if ( !v15 )
LABEL_58:
    v11 = "OK";
  else
LABEL_18:
    v11 = "NOPE";
  puts(v11);
  return 0;
}
// 100003D88: using guessed type __int64 __fastcall sub_100003D88(__n128, __n128);
// 100003E30: using guessed type __int64 __fastcall sub_100003E30(_QWORD, _QWORD, _QWORD, _QWORD);
// 100003F10: using guessed type __int128 xmmword_100003F10;
// 100003F20: using guessed type __int128 xmmword_100003F20;
// 100003F30: using guessed type __int128 xmmword_100003F30;
// 100003F40: using guessed type __int128 xmmword_100003F40;
// 100003F50: using guessed type __int128 xmmword_100003F50;

//----- (0000000100003D88) ----------------------------------------------------
__int64 sub_100003D88()
{
  size_t v1; // [xsp+8h] [xbp-2B8h] BYREF
  _BYTE v2[32]; // [xsp+10h] [xbp-2B0h] BYREF
  unsigned int v3; // [xsp+30h] [xbp-290h]
  int v4[2]; // [xsp+298h] [xbp-28h] BYREF
  int v5; // [xsp+2A0h] [xbp-20h]
  pid_t v6; // [xsp+2A4h] [xbp-1Ch]

  *(_QWORD *)v4 = 0xE00000001LL;
  v5 = 1;
  v6 = getpid();
  v1 = 648LL;
  bzero(v2, 0x288uLL);
  if ( sysctl(v4, 4u, v2, &v1, 0LL, 0LL) )
    return 0LL;
  else
    return (v3 >> 11) & 1;
}

//----- (0000000100003E30) ----------------------------------------------------
int *__fastcall sub_100003E30(int *result, int *a2, __int64 a3, __int64 a4)
{
  __int64 v4; // x8
  int v5; // w13
  unsigned int v6; // w11
  unsigned int v7; // w15
  unsigned int v8; // w13
  unsigned int v9; // w14
  int v10; // w9

  v4 = 0LL;
  v5 = *result;
  v6 = *a2;
  do
  {
    v7 = *(_DWORD *)(a4 + 4 * v4);
    v8 = *(_DWORD *)(a3 + 4 * (v4++ & 3)) + v5 + (v7 ^ 0x9E3779B9);
    v9 = v8 + __ROR4__(v6, -3 - (v7 & 7));
    v5 = (v9 + *(_DWORD *)(a3 + 4 * (v4 & 3)) + __ROR4__(v9, -5 - ((v7 >> 3) & 7))) ^ v6;
    v6 = v9;
  }
  while ( v4 != 9 );
  v10 = *(_DWORD *)(a3 + 12) + v5;
  *result = *(_DWORD *)(a3 + 8) ^ v9;
  *a2 = v10;
  return result;
}

// nfuncs=10 queued=3 decompiled=3 lumina nreq=0 worse=0 better=0
// ALL OK, 3 function(s) have been successfully decompiled
